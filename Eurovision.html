<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eurovision Rösta med Familjetopplistor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .participants {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .participant-card {
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
        }

        .scoreboard {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .family-scoreboards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .family-card {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            background-color: #f9f9f9;
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        select {
            padding: 5px;
            margin: 5px 0;
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>Eurovision Song Contest 2024</h1>
    
    <div class="scoreboard">
        <h2>Huvudpoängtavla</h2>
        <ol id="scoreboardList"></ol>
    </div>

    <div class="participants" id="participantsContainer"></div>

    <div class="family-scoreboards">
        <!-- Carl Johan -->
        <div class="family-card">
            <h3> Carl-Johan </h3>
            <form onsubmit="handleFamilyVote(event, 0)">
                <select required class="rank1">
                    <option value="">Välj 1:a plats</option>
                </select>
                <select required class="rank2">
                    <option value="">Välj 2:a plats</option>
                </select>
                <select required class="rank3">
                    <option value="">Välj 3:e plats</option>
                </select>
                <button type="submit">Spara röster</button>
            </form>
            <h4>Min topplista:</h4>
            <ol id="family0"></ol>
        </div>

        <!-- Ulrika -->
        <div class="family-card">
            <h3> Tindra </h3>
            <form onsubmit="handleFamilyVote(event, 0)">
                <select required class="rank1">
                    <option value="">Välj 1:a plats</option>
                </select>
                <select required class="rank2">
                    <option value="">Välj 2:a plats</option>
                </select>
                <select required class="rank3">
                    <option value="">Välj 3:e plats</option>
                </select>
                <button type="submit">Spara röster</button>
            </form>
            <h4>Min topplista:</h4>
            <ol id="family0"></ol>
        </div>

        <!-- Fem familjetopplistor -->
        <div class="family-card">
            <h3> Oscar </h3>
            <form onsubmit="handleFamilyVote(event, 0)">
                <select required class="rank1">
                    <option value="">Välj 1:a plats</option>
                </select>
                <select required class="rank2">
                    <option value="">Välj 2:a plats</option>
                </select>
                <select required class="rank3">
                    <option value="">Välj 3:e plats</option>
                </select>
                <button type="submit">Spara röster</button>
            </form>
            <h4>Min topplista:</h4>
            <ol id="family0"></ol>
        </div>

        <!-- Fem familjetopplistor -->
        <div class="family-card">
            <h3> Ulrika </h3>
            <form onsubmit="handleFamilyVote(event, 0)">
                <select required class="rank1">
                    <option value="">Välj 1:a plats</option>
                </select>
                <select required class="rank2">
                    <option value="">Välj 2:a plats</option>
                </select>
                <select required class="rank3">
                    <option value="">Välj 3:e plats</option>
                </select>
                <button type="submit">Spara röster</button>
            </form>
            <h4>Min topplista:</h4>
            <ol id="family0"></ol>
        </div>

        <!-- Fem familjetopplistor -->
        <div class="family-card">
            <h3> Gustav </h3>
            <form onsubmit="handleFamilyVote(event, 0)">
                <select required class="rank1">
                    <option value="">Välj 1:a plats</option>
                </select>
                <select required class="rank2">
                    <option value="">Välj 2:a plats</option>
                </select>
                <select required class="rank3">
                    <option value="">Välj 3:e plats</option>
                </select>
                <button type="submit">Spara röster</button>
            </form>
            <h4>Min topplista:</h4>
            <ol id="family0"></ol>
        </div>


        <!-- Upprepa för resterande 4 familjemedlemmar -->
        <!-- Du kan kopiera ovanstående block 4 gånger och ändra index -->
    </div>

    <script>
        // Initial data
        let participants = [
            { id: 1, name: "Tattoo", country: "Sverige", points: 0 },
            { id: 2, name: "Cha Cha Cha", country: "Finland", points: 0 },
            { id: 3, name: "Queen of Kings", country: "Norge", points: 0 },
        ];

        let familyTopLists = Array(5).fill().map(() => ({
            rankings: [],
            points: {}
        }));

        // Ladda sparad data
        function loadData() {
            const savedData = localStorage.getItem('eurovisionData');
            if (savedData) {
                const data = JSON.parse(savedData);
                participants = data.participants;
                familyTopLists = data.familyTopLists;
            }
        }

        // Spara data
        function saveData() {
            const data = {
                participants,
                familyTopLists
            };
            localStorage.setItem('eurovisionData', JSON.stringify(data));
        }

        // Initiera appen
        function initApp() {
            loadData();
            populateSelects();
            renderParticipants();
            renderScoreboard();
            renderAllFamilyLists();
        }

        // Fyll i select-menyer
        function populateSelects() {
            document.querySelectorAll('select').forEach(select => {
                if (!select.innerHTML.includes('value="')) {
                    select.innerHTML += participants.map(p => 
                        `<option value="${p.id}">${p.country}</option>`
                    ).join('');
                }
            });
        }

        // Rösta direkt
        function vote(participantId) {
            const participant = participants.find(p => p.id === participantId);
            participant.points += 1;
            updateParticipant(participantId);
            renderScoreboard();
            saveData();
        }

        // Hantera familjeröstning
        function handleFamilyVote(event, familyIndex) {
            event.preventDefault();
            const form = event.target;
            const selections = [
                parseInt(form.querySelector('.rank1').value),
                parseInt(form.querySelector('.rank2').value),
                parseInt(form.querySelector('.rank3').value)
            ];

            // Ta bort gamla poäng
            const oldPoints = familyTopLists[familyIndex].points;
            participants.forEach(p => {
                p.points -= oldPoints[p.id] || 0;
            });

            // Räkna nya poäng (12, 10, 8)
            const newPoints = {};
            selections.forEach((id, index) => {
                const points = [12, 10, 8][index];
                if (id) {
                    newPoints[id] = points;
                    participants.find(p => p.id === id).points += points;
                }
            });

            // Uppdatera data
            familyTopLists[familyIndex] = {
                rankings: selections,
                points: newPoints
            };

            // Uppdatera vyer
            renderAllFamilyLists();
            renderScoreboard();
            saveData();
        }

        // Rendera deltagare
        function renderParticipants() {
            const container = document.getElementById('participantsContainer');
            container.innerHTML = participants.map(p => `
                <div class="participant-card">
                    <h3>${p.country}</h3>
                    <p>${p.name}</p>
                    <p>Poäng: <span class="points-${p.id}">${p.points}</span></p>
                    <button onclick="vote(${p.id})">Ge 1 poäng</button>
                </div>
            `).join('');
        }

        // Rendera huvudtavla
        function renderScoreboard() {
            const sorted = [...participants].sort((a, b) => b.points - a.points);
            const html = sorted.map(p => 
                `<li>${p.country} - ${p.points} poäng</li>`
            ).join('');
            document.getElementById('scoreboardList').innerHTML = html;
        }

        // Rendera alla familjelistor
        function renderAllFamilyLists() {
            familyTopLists.forEach((list, index) => {
                const container = document.getElementById(`family${index}`);
                if (container) {
                    container.innerHTML = list.rankings.filter(id => id).map(id => {
                        const p = participants.find(p => p.id === id);
                        return `<li>${p.country} (${list.points[id]}p)</li>`;
                    }).join('');
                }
            });
        }

        // Starta appen
        window.onload = initApp;
    </script>
</body>
</html>